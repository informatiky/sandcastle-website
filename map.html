<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Map Example</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');
        body { margin: 0; padding: 0; }
        #map { position: relative; height: 100%; bottom: 0; width: 100%; }
        #buttons button { margin-bottom: 5px; }
        #layer-select {
            font-family: "Lexend", sans-serif;
            border: none;
            font-size: 16px;
        }
        #layers-dropdown label {
            font-size: 20px;
        }
        #layers-dropdown{
            font-size: 20px;
            font-family: "Lexend", sans-serif;
            color: #000;
            position: fixed;
            bottom: 100px;
            right: 100px;
            z-index: 1;
            padding: 10px;
            background-color: #FFDDAB;
            border-radius: 10px 10px 0 0;
            border-bottom: #FFBB6D 5px solid;
        }
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #59AABD;
            width: 100%;
            padding: 40px;
            margin: 0;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            font-family: "Lexend", sans-serif;
            font-weight: 400;
            font-style: normal;
            position: relative;
            z-index: 2;
        }

        #header-left {
            display: flex;
            align-items: center;
        }

        .aicsLogo {
            width: 100px;
            margin-right: 20px;
        }

        #header-right {
            display: flex;
            flex-wrap: nowrap; /* Prevent icons from wrapping to a new line */
        }

        .menu {
            width: 50px;
            height: 50px;
            margin-left: 10px;
            flex-shrink: 0; /* Prevent icons from shrinking */
        }
        #map-container {
            position: absolute;
            top: 163px/* height of your header */;
            bottom: 0;
            width: 100%;
            z-index: 1;
        }
        #organic-transition {
            position: absolute;
            top: 0;
            width: 100%;
            z-index: 2;
        }
    </style>
</head>
<body>

<div id="header">
    <div id="header-left">
        <img class="aicsLogo" src="assets/aics.png" />
        <h1>SandCastle Web</h1>
    </div>
    <div id="header-right">
        <a href="index.html"><img class="menu" src="assets/home.svg" /></a>
        <a href="map.html"><img class="menu" src="assets/map.svg" /></a>
        <a href="tips.html"><img class="menu" src="assets/tips.svg" /></a>
        <a href="history.html"><img class="menu" src="assets/history.svg" /></a>
        <a href="info.html"><img class="menu" src="assets/info.svg" /></a>
    </div>
</div>

<div id="map-container">
<div id="organic-transition">
    <svg viewBox="0 0 1000 100" preserveAspectRatio="none">
        <path d="M 153 0 L 286 53 L 529 17 L 753 5 L 901 28 L 1000 13 L 1000 0 L 0 0 Z" fill="#59AABD" />
    </svg>
</div>

<div id="map"></div>
</div>
<div id="layers-dropdown">
    <label for="layer-select">Select a Floor:</label>
    <select id="layer-select">
        <option value="dobrev-internalstreet">Internal Street</option>
        <option value="dobrev-groundfloor">Ground Floor</option>
        <option value="dobrev-entresol">Entresol</option>
        <option value="dobrev-firstfloor">First Floor</option>
        <option value="dobrev-secondfloor">Second Floor</option>
        <option value="dobrev-thirdfloor">Third Floor</option>
        <option value="dobrev-fourthfloor">Fourth Floor</option>
        <option value="dobrev-fithfloor">Fifth Floor</option>
    </select>
</div>


<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZG9icmV2IiwiYSI6ImNsdXh2bHNsZzB0anAya3J5ZWt4d2kxdGcifQ.16chPGvuiy7NtNPT40j4-Q';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/dobrev/cluwr3e3h002f01oc1wa77c4o',
        zoom: 16,
        maxBounds: [
            [4.949129830812353,
                52.31182846468624], // Southwest coordinates
            [4.952162156771436,
                52.31325386724649], // Northeast coordinates
        ],
        center: [4.950331, 52.312669]
    });

    map.on('load', function() {
        // Set the initial visibility of all layers to 'none'
        map.setLayoutProperty('dobrev-internalstreet', 'visibility', 'visible');
        map.setLayoutProperty('dobrev-groundfloor', 'visibility', 'none');
        map.setLayoutProperty('dobrev-entresol', 'visibility', 'none');
        map.setLayoutProperty('dobrev-firstfloor', 'visibility', 'none');
        map.setLayoutProperty('dobrev-secondfloor', 'visibility', 'none');
        map.setLayoutProperty('dobrev-thirdfloor', 'visibility', 'none');
        map.setLayoutProperty('dobrev-fourthfloor', 'visibility', 'none');
        map.setLayoutProperty('dobrev-fithfloor', 'visibility', 'none');
    });

    document.getElementById('layer-select').addEventListener('change', function() {
        const selectedLayer = this.value;
        const layers = ['dobrev-internalstreet', 'dobrev-groundfloor', 'dobrev-entresol', 'dobrev-firstfloor', 'dobrev-secondfloor', 'dobrev-thirdfloor', 'dobrev-fourthfloor', 'dobrev-fithfloor'];
        const layersToHide = layers.filter(layer => layer !== selectedLayer);
        toggleLayerVisibility(selectedLayer, layersToHide);
    });

    function toggleLayerVisibility(layerToShow, layersToHide) {
        // Set the visibility of the layer to show
        map.setLayoutProperty(layerToShow, 'visibility', 'visible');

        // Hide the layers that need to be hidden
        layersToHide.forEach(function(layer) {
            map.setLayoutProperty(layer, 'visibility', 'none');
        });
    }

    map.addControl(
        new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            // When active the map will receive updates to the device's location as it changes.
            trackUserLocation: true,
            // Draw an arrow next to the location dot to indicate which direction the device is heading.
            showUserHeading: true
        })
    );



    // Select all menu images
    let menuImages = document.querySelectorAll('.menu');

    // Loop through each image
    menuImages.forEach((img) => {
        // Store the original src
        let originalSrc = img.src;

        // Check if the image is not home.svg
        if (!originalSrc.includes('map.svg')) {
            // Add mouseover event listener
            img.addEventListener('mouseover', function() {
                // Change the src to the new image
                // Append 'a' to the original image name
                img.src = originalSrc.replace('.svg', 'a.svg');
            });

            // Add mouseout event listener
            img.addEventListener('mouseout', function() {
                // Change the src back to the original image
                img.src = originalSrc;
            });
        }
    });

    window.onload = function() {
        var header = document.getElementById('header');
        var headerHeight = header.offsetHeight;
        console.log('Header height is: ', headerHeight);

        var mapContainer = document.getElementById('map-container');
        mapContainer.style.top = `${headerHeight}px`;
    }
</script>
</body>
</html>